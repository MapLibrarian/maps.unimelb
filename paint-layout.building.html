%begin_asset_metadata_ObjectType^contains:Building%
<div class="headerless"></div>
<div class="detail location">
    <h1 class="aligned-title"><span data-icon="faculty"></span> %asset_metadata_Name%</h1>
  <div class="upper">
    <div class="aside">
      <div class="where">
%begin_asset_metadata_BuildingNumber%
      	<div>
      		<p>Building Number: <span class="building-number">%asset_metadata_BuildingNumber%</span></p>
		</div>
%end_asset_metadata_BuildingNumber%
        <ul class="extras">
%begin_asset_metadata_AlternateName%
            <li><span>Also known as:</span> %asset_metadata_AlternateName%</li>
%end_asset_metadata_AlternateName%
%begin_asset_metadata_StreetAddress%
            <li><span>Address:</span> %asset_metadata_StreetAddress%</li>
%end_asset_metadata_StreetAddress%
%begin_asset_metadata_Directions%
			<li><span>Extra directions:</span> %asset_metadata_Directions%</li>
%end_asset_metadata_Directions%
%begin_asset_metadata_CampusMapRefA%
            <li><span title="From the downloadable map">Campus Grid Ref:</span> %asset_metadata_CampusMapRefA% %asset_metadata_CampusMapRefN%</li>
%end_asset_metadata_CampusMapRefA%
%begin_asset_metadata_InfoURL%
			<li><a href="%asset_metadata_InfoURL%">More information</a></li>
%end_asset_metadata_InfoURL%
		</ul>
        <ul class="social-links">
          <li>
            <a href="https://twitter.com/intent/tweet?text=%asset_metadata_Name%++%asset_url%"><span class="small icon--hide-label" data-icon="twitter">Share on Twitter</span></a>
          </li>
          <li>
            <a href="https://www.facebook.com/sharer/sharer.php?u=%asset_url%"><span class="small icon--hide-label" data-icon="facebook">Share on Facebook</span></a>
          </li>
          <li>
            <a href="https://www.linkedin.com/shareArticle?title=%asset_metadata_Name%&#038;url=%asset_url%"><span class="small icon--hide-label" data-icon="linkedin">Share on LinkedIn</span></a>
          </li>
          <li>
            <a href="#" data-modal-offset="" data-modal-target="share-modal"><span class="small icon--hide-label" data-icon="share">Get a short URL, or embed code</span></a>
          </li>
        </ul>
      </div>
    </div>
%begin_asset_metadata_VirtualURL%
<section id="display">
    <div class="tabbed" data-tabbed="true">
        <nav role="tablist">
    		<a href="#map-tab" role="tab">Map</a>
    		<a href="#virtual-tab" role="tab">Virtual</a>
    		%begin_asset_metadata_Photo%
    			<a href="#photo-tab" role="tab">Photo</a>
    		%end_asset_metadata_Photo%
    	</nav>
    	<section id="map-tab" role="tabpanel">
    		<div id='map'></div>
    	</section>
    	<section id="virtual-tab" role="tabpanel">
    	    %asset_metadata_VirtualURL^replace:(width="\d{3}"):width="100&#37;"^replace:(height="\d{3}"):height="640"%
    	</section>
		%begin_asset_metadata_Photo%
		<section id="photo-tab" role="tabpanel">
		    <figure class="full-width" role="group"><img src="%asset_metadata_Photo^as_asset:asset_url%" alt="Photograph of %asset_metadata_Name%" />%begin_asset_metadata_Photo^as_asset:asset_attribute_caption%<figcaption>%asset_metadata_Photo^as_asset:asset_attribute_caption%</figcaption>%end_asset_metadata%</figure></section>
		%end_asset_metadata_Photo%
    </div>
</section>
%else_begin_asset_metadata_Photo%
<section id="display">
  <div class="tabbed" data-tabbed="true">
    <nav role="tablist">
		<a href="#map-tab" role="tab">Map</a>
		<a href="#photo-tab" role="tab">Photo</a>
	</nav>
	<section id="map-tab" role="tabpanel">
		<div id='map'></div>
	</section>
	<section id="photo-tab" role="tabpanel">
	    <figure class="full-width" role="group"><img src="%asset_metadata_Photo^as_asset:asset_url%" alt="Photograph of %asset_metadata_Name%" />%begin_asset_metadata_Photo^as_asset:asset_attribute_caption%<figcaption>%asset_metadata_Photo^as_asset:asset_attribute_caption%</figcaption>%end_asset_metadata%</figure>
	</section>
  </div>
</section>
%else_globals%
    <div id='map'></div>
%end_globals%
</div>

<div class="modal__dialog" id="share-modal">		<h2>Use this map</h2>
	<ul class="use-map">
		<li>View in:
		<a href="http://www.google.com.au/maps/?q=%asset_metadata_Latitude^maxchars:10%,%asset_metadata_Longitude^maxchars:10%">Google maps</a>,
		<a href="https://www.openstreetmap.org/?mlat=%asset_metadata_Latitude^maxchars:10%&mlon=%asset_metadata_Longitude^maxchars:10%#map=17/%asset_metadata_Latitude^maxchars:10%/%asset_metadata_Longitude^maxchars:10%">Open Street Map</a>
		</li>
		<li>Get a short URL at <a href="http://go.unimelb.edu.au/add?link_location=%asset_url%" rel="nofollow">go.unimelb</a></li>
		<li id="embed-code">Embed this map: <input aria-label="Not a form input. Contains embed code for copying." onfocus="select()" type="text" value="&lt;iframe src='%asset_url%?SQ_DESIGN_NAME=embed' height='450' width='100%' frameborder='0'&gt;&lt;a href='%asset_url%'&gt;%asset_metadata_Name%&lt;/a&gt;&lt;/iframe&gt;"></li>
		<li>
		<a href="geo:%asset_metadata_Latitude^maxchars:10%,%asset_metadata_Longitude^maxchars:10%">Geo <small>(Latitude, Longitude)</small>: <span class="latitude">%asset_metadata_Latitude^maxchars:10%</span>, <span class="longitude">%asset_metadata_Longitude^maxchars:10%</span></a>
		</li>
	</ul>
</div>

<div class="lower">
    %asset_contents%
    %globals_asset_contents_raw:1971471%
</div>

</div>

<script>
var myAccessToken = "pk.eyJ1IjoibWFwcy11bmltZWxiIiwiYSI6ImNpZmkxajZyNGJtYWJzeWx4ZjRwbmdvMzAifQ.CahREikX9S7i791MIkHrAQ";
var maplat = "%globals_asset_metadata_Latitude^maxchars:10%";
var maplon = "%globals_asset_metadata_Longitude^maxchars:10%";
var mapzoom = "%asset_metadata_Zoom^empty:16%";
var locname = "%globals_asset_metadata_Name^escapehtml^escapequotes^tagif:h3%";
var locaddr = "%globals_asset_metadata_StreetAddress^escapehtml^escapequotes^tagif:p%";

if(mapboxgl.supported() === false) {
    var JsUrl = 'https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js',
        cssUrl = 'https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css';
    loadScript(JsUrl, cssUrl, initJS);
} else {
    var JsUrl = 'https://api.mapbox.com/mapbox-gl-js/v0.31.0/mapbox-gl.js',
        cssUrl = 'https://api.mapbox.com/mapbox-gl-js/v0.31.0/mapbox-gl.css';
    loadScript(JsUrl, cssUrl, initGL);
}

function initGL() {
    mapboxgl.accessToken = myAccessToken;
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/maps-unimelb/cih6p39i800fh90m6dgkkgotk',
        center: [maplon, maplat],
        zoom: mapzoom
    });
	map.addControl(new mapboxgl.NavigationControl(), 'top-left');
    map.scrollZoom.disable();
    var tooltip = new mapboxgl.Popup({closeOnClick: false})
        .setLngLat([maplon, maplat])
        .setHTML('<div class="popup">' + locname + locaddr + '</div>')
        .addTo(map);
}

function initJS() {
    mapzoom = parseInt(mapzoom)+1;
    L.mapbox.accessToken = myAccessToken;
    var map = L.mapbox.map('map', 'maps-unimelb.2c79eb85')
        .setView([maplat, maplon], mapzoom);
    map.scrollWheelZoom.disable();
    L.marker([maplat, maplon]).addTo(map)
    .bindPopup(locname + locaddr).openPopup();
}

function loadScript(sScriptSrc, cssSrc, oCallback) {
/* adapted from - http://stackoverflow.com/questions/11160948/how-to-know-if-jquery-has-finished-loading/11161045#11161045.1 */

    var oHead = document.getElementsByTagName('head')[0];
    var oScript = document.createElement('script');

    var oCss = document.createElement('link');
    oCss.href = cssSrc;
    oCss.rel = 'stylesheet';
    oHead.appendChild(oCss);

    // make sure callback isn't run more than once
    function runCallback() {
        if (oCallback) {
            oCallback();
            oScript.onload = oScript.onreadystatechange = null;
            oCallback = null;
        }
    }

    oScript.type = 'text/javascript';
    // most browsers
    oScript.onload = runCallback;
    // IE 6 & 7
    oScript.onreadystatechange = function() {
        if (this.readyState === 'complete') {
            runCallback();
        }
    }
    oScript.src = sScriptSrc;
    oHead.appendChild(oScript);
}

</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Place",
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": "%asset_metadata_Latitude^maxchars:10%",
    "longitude": "%asset_metadata_Longitude^maxchars:10%"
  },
  "name": "%asset_metadata_Name% - The University of Melbourne"
}
</script>
%end_asset_metadata_ObjectType^contains:Building%
